{"version":3,"sources":["../src/BaseZmooth.ts","../src/ZmoothArray.ts","../src/ZmoothNumber.ts","../src/ZmoothManager.ts","../src/index.ts"],"sourcesContent":["export abstract class BaseZmooth<T> {\n    protected _value: T;\n    to: T;\n    speed: number;\n    private _alive = true;\n\n    constructor(value: T, to: T, speed: number = 1) {\n        this._value = value;\n        this.to = to;\n        this.speed = speed;\n    }\n\n    abstract update(delta: number): void;\n\n    kill() {\n        this._alive = false;\n    }\n\n    get value() {\n        return this._value;\n    }\n\n    get alive() {\n        return this._alive;\n    }\n\n    protected smoothValue(from: number, to: number, delta: number) {\n        return from + (to - from) * this.speed * delta;\n    }\n}\n","import { BaseZmooth } from './BaseZmooth';\n\nexport class ZmoothArray extends BaseZmooth<number[]> {\n    onChange?: (values: number[]) => void;\n\n    constructor(value: number[] = [], speed?: number, onChange?: (values: number[]) => void) {\n        super(value, value, speed);\n\n        this.onChange = onChange;\n    }\n\n    update(delta: number) {\n        let i = this._value.length;\n        while (i-- > 0) {\n            this._value[i] = this.smoothValue(this._value[i], this.to[i], delta);\n        }\n\n        this.onChange?.(this._value);\n    }\n}\n","import { BaseZmooth } from './BaseZmooth';\n\nexport class ZmoothNumber extends BaseZmooth<number> {\n    onChange?: (value: number) => void;\n\n    constructor(value: number = 0, speed: number = 1, onChange?: (value: number) => void) {\n        super(value, value, speed);\n\n        this.onChange = onChange;\n    }\n\n    update(delta: number) {\n        this._value = this.smoothValue(this._value, this.to, delta);\n\n        this.onChange?.(this._value);\n    }\n}\n","import { BaseZmooth } from './BaseZmooth';\nimport { ZmoothArray } from './ZmoothArray';\nimport { ZmoothNumber } from './ZmoothNumber';\n\nexport class ZmoothManager {\n    private zmooths: BaseZmooth<unknown>[] = [];\n    private lastTime = performance.now();\n    private rafID: number = -1;\n\n    constructor(autoUpdate: boolean = true) {\n        if (autoUpdate) {\n            this.rafID = requestAnimationFrame(this.autoUpdate.bind(this));\n        }\n    }\n\n    autoUpdate() {\n        const now = performance.now();\n        const delta = (now - this.lastTime) / 1000;\n        this.lastTime = now;\n\n        this.update(delta);\n\n        this.rafID = requestAnimationFrame(this.autoUpdate.bind(this));\n    }\n\n    /**\n     * Update all zmooth objects\n     * @param delta delta time in seconds\n     */\n    update(delta: number) {\n        let i = this.zmooths.length;\n        while (i-- > 0) {\n            const zmooth = this.zmooths[i];\n\n            if (zmooth.alive) {\n                zmooth.update(delta);\n            } else {\n                this.zmooths.splice(i, 1);\n            }\n        }\n    }\n\n    /**\n     * Smooth a value to its destination value\n     * Each time you assign a value via myZmooth.to, it will smoothly interpolate to the destination value\n     * You can assign a new value via .to any time you want\n     * @example\n     * const myZmooth = zmooth.val(0, 5, function(value) {\n     *     console.log(value);\n     * });\n     * \n     * // will smoothly change from 0 to 10\n     * myZmooth.to = 10;\n     * \n     * setTimeout(function() {\n     *     // will smoothly change from current myZmooth value to 20\n     *     myZmooth.to = 20;\n     * }, 2000);\n     * @param value Start value\n     * @param speed Speed of change. The formula is: value = value + (toValue - currValue) * delta * speed\n     * @param onChange Callback each time the value is updated\n     * @returns \n     */\n    val<T extends number | number[]>(value: T, speed?: number, onChange?: (value: T) => void) {\n        // FIXME\n        // @ts-ignore\n        const zmooth = Array.isArray(value) ? new ZmoothArray(value, speed, onChange) : new ZmoothNumber(value, speed, onChange);\n        this.zmooths.push(zmooth);\n        return zmooth;\n    }\n\n    /**\n     * Identical to val()\n     * The difference is that the new value will be automatically assigned to the property in the object you passed in parameters\n     * @example\n     * const myObj = {\n     *     myValue: 0,\n     * };\n     * \n     * // now property 'myValue' on object myObj is managed automatically\n     * const myZmooth = zmooth.prop(myObj, 'myValue');\n     * \n     * // now myObj.value will automatically be interpolated to 10\n     * myZmooth.to = 10;\n     * @param obj Any javascript object\n     * @param propertyName Property that must be smoothed\n     * @param speed Speed of change\n     * @param onChange Callback each time the value is updated\n     * @returns \n     */\n    prop<T extends Record<any, any>>(obj: T, propertyName: keyof T, speed?: number, onChange?: (value: any) => void): BaseZmooth<any> {\n        return this.val(obj[propertyName], speed, (value: any) => {\n            obj[propertyName] = value;\n            onChange?.(value);\n        });\n    }\n\n    /**\n     * Kill a zmooth object\n     * @param zmooth zmooth object to kill\n     */\n    kill(zmooth: BaseZmooth<unknown>) {\n        zmooth.kill();\n    }\n\n    /**\n     * Kill all zmooth objects\n     */\n    killAll() {\n        let i = this.zmooths.length - 1;\n        while (i-- > 0) {\n            this.zmooths[i].kill();\n        }\n\n        this.zmooths = [];\n    }\n\n    /**\n     * Destroy the zmooth manager\n     */\n    destroy() {\n        this.killAll();\n\n        cancelAnimationFrame(this.rafID);\n    }\n}\n","import { ZmoothManager } from './ZmoothManager';\n\nconst globalManager = new ZmoothManager(true);\n\nexport default {\n    inst: (autoUpdate?: boolean) => new ZmoothManager(autoUpdate),\n    val: globalManager.val.bind(globalManager),\n    prop: globalManager.prop.bind(globalManager),\n    killAll: globalManager.killAll.bind(globalManager),\n};\n"],"mappings":"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","names":[]}